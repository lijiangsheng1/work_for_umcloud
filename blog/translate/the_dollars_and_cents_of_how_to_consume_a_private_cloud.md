# 这次我们聊聊私有云烧钱那点事

在[人们是如何构建私有云的](https://www.mirantis.com/blog/how-does-the-world-consume-private-clouds/)一文中，我们探讨了构建私有云的几种不同的方式，它们分别是：

1. 自己搞定（DIY）
2. 从软件供应商哪里购买
3. 交给托管云厂商（用户的硬件或数据中心、软件管理等均由托管云厂商提供）
4. 托管服务（所有的均外包出去）

我们这次就聊聊上述前三者的开销，当然我们也不是将决定的总拥有成本（TCO）来分析的，我们相对聚焦于三个场景中平行的比较，比如，我们不会将硬件的成本计算在内。

当然，开销仅是用户选择云计算构建模式关键的因素之一，其它的关键因素还有能够招聘到优秀的 OpenStack 技术人才、长远的战略利益、能够定制的能力等等，限于篇幅，这次我们仅讨论开销，俗称“烧钱”的因素。

## DIY

这乍看之下似乎是根本就不会花钱的方式。不是说好的，OpenStack 是开源的免费软件吗？只需要下载、安装，然后就完事大吉了？去你春秋大梦去吧！没错开源软件能够带来诸多的好处，更快的创新速度、用户可以直接影响项目的功能和未来的走向、避免厂商锁定、通过定义API、驱动程序和插件来实现事实上的标准，但是“免费”绝对不是开源软件的好处之一，开源的项目还离完善的产品有很长一段距离。

以下表格中的内容，是典型的DIY场景下所产生的成本，之所以在这里列出，是因为我们长时间以来有机会和DIY OpenStack的同仁们接触、交流。

|   成本     |   具体项   |
| ------------- |:-------------:|
| 拥有13名工程师的工程师团队（规模固定，和云的扩展规模无关。）      | 其中5名工程师是参与到上游的（修复缺陷、开发新功能、创建可参考的架构指南），5名QA工程师（打包、质量测试、以及做一些互操作的测试），3名生命周期管理和监控的工程师  |
| 拥有9名工程师的IT/Ops团队  （规模固定，和云的扩展规模无关。）    | 1名IT架构师（架构、容量规划），1名L3级别的工程师（故障排查），2名L2级别的工程师（部署、更新、升级、以及正在进行的管理工作），5名L1级别的工程师（用于监控、基础的故障检查、以及响应用户的请求）。 |
| 每100节点配置1.1名工程师，每1PB存储配备1.1名工程师，（团队的大小随着云平台规模的而变化，只在过去固定大小的最小值时才启动 - 因此没有重复计数）      | 计算：每100节点配备0.3名 IT/OPS 架构师；每100节点配备0.1名 L3 IT／OPS 工程师；每100节点配备0.3名 L2 IT／OPS 工程师；每100节点配备0.4名 L1 IT／OPS 工程师。 存储：每1PB存储配备0.3名IT/OPS 架构师；每1PB存储配备0.1名 L3 IT/OPS 工程师；每1PB存储配备0.3名 L2 IT/OPS 工程师；每1PB存储配备0.4名 L1 IT/OPS 工程师； |
|  开发／测试 云平台     | 测试更新，升级，配置更改等需要3年的折旧 $50,000。 |
| 可用性损失      | DIY的云平台相比而言，可用性要差很多，计算每年云平台停机时间的分钟数，然后乘以每分钟的边际损失来计算总量。举例来说，一个可用性为98%的云平台，每分钟损失$50的话，每年算下来总数是 $525,600 。 |
|  生产延误     |DIY 通常都会延迟交付，需要长时间的实现。举例来说：延误6个月的，每个月的损失是$50,000 ，那么总数就是$300,000。  |

## 从软件供应商哪里购买

在此中场景下，工程团队转嫁到了供应商，但是IT/OPS的任务还需要自己来负责，下表显示了其开销状况：

|   成本     |   具体项   |
| ------------- |:-------------:|
| 拥有9名工程师的IT/Ops团队  （规模固定，和云的扩展规模无关。相比DIY团队规模小一些，因为软件供应商可以提供一些支持。）      | 0.5名IT架构师（架构、容量规划），1名L2级别的工程师（部署、更新、升级、以及正在进行的管理工作），2名L1级别的工程师（用于监控、基础的故障检查、以及响应用户的请求）。 |
| 每100节点配置1.1名工程师，每1PB存储配备1.1名工程师，（团队的大小随着云平台规模的而变化，只在过去固定大小的最小值时才启动 - 因此没有重复计数）      |计算：每100节点配备0.3名 IT/OPS 架构师；每100节点配备0.3名 L2 IT／OPS 工程师；每100节点配备0.4名 L1 IT／OPS 工程师。 存储：每1PB存储配备0.3名IT/OPS 架构师；每1PB存储配备0.3名 L2 IT/OPS 工程师；每1PB存储配备0.4名 L1 IT/OPS 工程师；  |
| 开发／测试云平台      |测试更新，升级，配置更改等需要3年的折旧 $50,000。  |
| 可用性损失  |在这三种形式的私有云而言，购买软件供应商的可靠性是中等，比DIY稍好，计算每年云平台停机时间的分钟数，然后乘以每分钟的边际损失来计算总量。举例来说，一个可用性为98%的云平台，每分钟损失$50的话，每年算下来总数是$262,800  |
|  软件支持费用     | 相比于替代了内部的工程和IT/OPS团队，在此场景下，要付费给软件供应商。 |

## 交给托管云厂商

托管云相比上述要简单的多，因为工程师和IT／OPS全部托付给了云托管商，其开销如下面表格所示：

|   成本     |   具体项   |
| ------------- |:-------------:|
| 可用性损失    | 在这三种形式的私有云而言，托管云是可靠性最强的，计算每年云平台停机时间的分钟数，然后乘以每分钟的边际损失来计算总量。举例来说，一个可用性为98%的云平台，每分钟损失$50的话，每年算下来总数是$52,560。 |
| 托管服务开销   | 相比于替代了内部的工程和IT/OPS团队，在此场景下，只需要付费给托管云供应商即可。 |

## 总结

最后，我们将上述的三个场景作一个总结：

<dl>
<table style="width:100%">
  <tr>
    <th></th>
    <th colspan="3">相对成本（4年时间）</th>
  </tr>
  <tr>
    <td>初始虚拟机数量</td>
    <td >3000</td>
    <td>20000</td>
    <td>60000</td>
  </tr>
  <tr>
    <td>DIY 每虚拟机花费</td>
    <td> \$1,448 </td>
    <td> \$249 </td>
    <td> \$118 </td>
  </tr>
  <tr>
    <td>软件供应商每虚拟机花费</td>
    <td>\$614</td>
    <td>\$179</td>
    <td>\$124</td>
  </tr>
  <tr>
    <td>托管云 每虚拟机花费</td>
    <td>\$298</td>
    <td>\$189</td>
    <td>\$149</td>
  </tr>
</table>
</dl>

由此表格可见，对于小规模的云来说，托管云是非常具有吸引力的，对于中等规模的云平台来说，从私有云软件提供商购买是相对蛮划算的，当然，对于大型的云平台来说，DIY 是最为省钱的方式，因为绝大多数时候，其可用性要保持在98.5%或更高，这要是购买或托管都是不靠谱的。
