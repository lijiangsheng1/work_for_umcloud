# Tieto 的 OpenStack 容器化之路

## 摘要

OpenStack 的运维难题，主要体现在升级上，复杂而多样的组件，让系统管理员头痛不已，也给开发者们带来不小的困扰，再加上试探性的开发模式，开始渐渐的让很多人开始丧失信心了。那么容器究竟是否是他的救命稻草，我们还无法预知，Kolla被一些人吹捧，Mirantis也不甘示弱，收购了TCP Cloud公司，希望借Kubernetes来拯救Fuel。那么我们不妨来看看OpenStack 容器化之路的实例。

------

Tieto 是北欧首屈一指的服务提供商，在当地拥有超过150家云计算的客户，以及相关的收入达15亿欧元。所以当该公司决定要采用 OpenStack时，绝对是一个超前的做法，但绝对不是草率的，也并没有不做相应的功课。

该公司对于将 OpenStack 组件容器化是不是一个好主意了呢？

## Tieto 想要什么

Tieto 的核心想法是，能够为用户提供双峰式的解决方案，从而能够解决用户的数字化业务的问题。为了做到这点，就必须有一个能够让Tieto有信心的基础设施，那么 OpenStack 被选择成为了云原生应用交付的平台。公司有如下几个目的：

* 一定不要被厂商绑定
* 实现无缝的、按需的弹性能力
* 拥有强大的自动化和编排能力
* 采用创新性的开源解决方案
* 实现基础设施即代码

相对于其它项而言，最后一项，即实现基础设施即代码，对于OpenStack来说是最大的一项挑战。

## 我们从哪里开始

事实上，在2013年 Tieto 就开始基于 OpenStack 做一些工作了，创建了一些内部的项目来评估 OpenStack 的 Havana 版和 Icehouse 版，使用的也是内部的软件开发项目；那时，目标架构也包括了 Open Vswitch 和 Neutron。

2015年，公司进一步扩展了云平台，聚焦于于 IaaS 的提供，以及提供独特应用的 PaaS 服务，但是对于横向扩展负载来说，缺少的是完全的 API 控制的基础设施共享平台。

到了今年，Tieto 决定将其的 OpenStack 云平台业务，使用了 tcp cloud（现在属于 Mirantis了） 的发行版，以及使用 OpenContrail 替换了  OpenVSwitch。

至于为什么是 OpenContrail ？Tieto 对外是这么讲的：

* **许可证**: OpenContrail 是一个开源的解决方案，但是商业上的支持也可由一些供应商提供，如 Mirantis。
* **高可用**: OpenContrail 自身就支持高可用。
* **云网关路由**: 南北向的流量必须由物理设备来承担，而不是现在的软件方案。
* **性能**: OpenContrail 能提供杰出的 pps、带宽、可扩展性、等等（可达到 9.6 Gbps）
* **SDN 和 Fabric之间的内部通信**: OpenContrail 支持动态的过去的链接，通过 EVPN 或 ToR 交换机实现。
* **容器**:OpenContrail 自身是支持容器的，这能够让混合环境成为了可能。

在首次敲定之后，Tieto 作了概念验证测试，内容包括：

* OpenContrail 2.21
* 20 台计算节点
* Glance 和 Cinder  后端跑的都是 Ceph
* Heat  编排

另外，Tieto 还实现了基础设施即代码，这是所有的部署和操作均采用的是 OpenStack Salt。这样的架构让Tieto 采用 DevOps 思路成为了可能，即使用陈述的配置存储到仓库中，在必要的时候可以重复利用。

## 遗漏了什么吗？

因为支持运维以及基础设施即代码，Tieto 的 OpenStack 云已然超越了很多其它的同类实现，然而，还没有想Iieto所希望的那样直接了当就完成的。

在设计的时候，此OpenStack 架构的组件是运行在了24个虚拟机中，至少需要3台 KVM 节点—— 且这仅仅是控制的面板。

![](https://cdn.mirantis.com/wp-content/uploads/2016/10/tieto.png)

正如你所预料的，尝试让这些虚拟机通过操作系统的更新和其它变更来保持一致，这会导致运维异常的复杂。随时更新是必须实现的功能，而且是具体到每一台虚拟机上。哦，当然，使用了OpenStack  Salt，即采纳了 DevOps 的优点，相对来说也可以解决问题，但是你要知道这将会是一些令人恐怖的琐碎活。

一定还有更好的办法解决它。

## 如何满足这些挑战？

“更好的方法”就是 OpenStack 的进化，将之按照容器化应用一样，全面发挥此架构的效率优势来，其中包括：

* **容易维护**:正因为每个服务不再拥有其自身的虚拟机了，只需要担心自己的操作系统即可。
* **更好的可靠性和更佳的可管理性**: 因为容器和Docker file是作为持续集成／持续部署的工作流的一部分来测试过的。
* **更新变得简单**: 因为一旦 OpenStack 被转换为微服务的架构的话，那些个服务是很容易替换掉的。
* **更好的性能和可扩展性**: 因为所有的 OpenStack  服务都是由 Kubernetes 来进行编排的。

这就是为什么 Tieto 采用容器化 OpenStack 服务！
